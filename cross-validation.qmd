
# Cross-validation {#sec-cross-validation}

```{r}
#| echo: false
source("_common.R")
source("_functions.R")
source("_load.R")
```

```{r}
#| echo: false
tablero_ctl <- board_folder(path = "tablero_ctl")
```

```{r}
#| echo: false
ctl_split <- pin_read(board = tablero_ctl, name = "ctl_split")
ctl_train <- training(ctl_split)
```

La validación cruzada de grupo V crea divisiones de los datos en función de
alguna variable de agrupación (que puede tener más de una fila asociada). La
función puede crear tantas divisiones como valores únicos de la variable de
agrupación o puede crear un conjunto más pequeño de divisiones donde más de un
grupo queda fuera a la vez. Un uso común de este tipo de remuestreo es cuando
se tienen medidas repetidas del mismo tema.

```{r}
# 31.22 seg
tictoc::tic()
ctl_folds <- group_vfold_cv(
 data    = ctl_train,             # <1>
 group   = "msisdn_dd",           # <2>
 v       = 5,                     # <3>
 balance = "observations",        # <4>
 strata  = "diag")                # <5>
tictoc::toc()
```

1. Usar el conjunto de datos de entrenamiento.
2. Se define la unidad experimental, que en este caso es el usuario como la
variable de agrupación. El objetivo es garantizar que todas las observaciones
para un usuario específico estén en el mismo *fold*.
3. Número de particiones (pliegos). Es el número de valores únicos en la
variable de agrupación. Debido a que tenemos un conjunto grande de
observaciones, elegiremos `v = 10`.
4. Intenta equilibrar el número de observaciones en cada *fold*.  La función
`group_vfold_cv()` intentará asignar aproximadamente el mismo número de
observaciones a cada *fold*, lo que podría ayudar a mitigar el impacto del
desbalanceo en la validación cruzada.
5. Estratificar es apropiado si se quiere asegurar que cada *fold* tenga una
distribución similar de la variable de diagnóstico. 


```{r}
ctl_folds
```

```{r}
#| echo: false
#| message: false
#| warning: false
pin_write(
 board       = tablero_ctl,
 x           = ctl_folds,
 name        = "ctl_folds", 
 type        = "rds", 
 title       = "Grouped cross-validation", 
 description = "Splited data based on userid variable")
```





























